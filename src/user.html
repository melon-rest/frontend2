<!doctype html>
<html>
<head>
  	<meta charset="UTF-8">
  	<meta name="viewport" content="width=device-width, initial-scale=1.0">
  	<link href="tw.css" rel="stylesheet">
	<script src="index.js"></script>
</head>
<body>
	<div class="flex h-screen bg-gray-900 bg-cover" id="background">
		<div class="m-auto max-w-lg p-8 backdrop-blur-lg text-white shadow-2xl grid grid-cols-2 gap-2" id="profile">
			<div>
				<img class="w-64 aspect-square" id="profile_picture">
			</div>
			
			<div>
				<h1 class="text-xl break-all" id="username"></h1>
				<div class="text-sm break-all" id="contact"></div>
				
				<div class="max-h-[10rem] overflow-auto break-all max-w-lg whitespace-pre-line" id="description"></div>
			</div>

		</div>
	</div>
	<script type="module">
		const params = new URLSearchParams(document.location.search);
		if(!params.has("username")) document.pathname = "/";

		const username = params.get('username');

		const req = await fetch(`${window.bio_pages.api}/user/${username}`);

		if(req.ok) {
			const json = await req.json();
			
			document.getElementById("description").innerText = json.description;
			document.getElementById("username").innerText = json.username;
			document.getElementById("contact").innerText = json.contact;

			document.getElementById("profile_picture").src = json.profile_picture ?
				`${window.bio_pages.cdn}${json.username}_pfp` : 
				"https://cdn.discordapp.com/attachments/922128925692420176/946504823220621384/missing-profile.png"

			if(json.background) {
				document.getElementById("background").style.backgroundImage = `url(${window.bio_pages.cdn}${json.username}_bg)`;
			} else {
				document.getElementById("profile").classList.add("bg-gray-800");
			}

		} else {
			document.getElementById("description").innerText = "This user you queried does not exist.";
			document.getElementById("username").innerText = "missing user :(";
			document.getElementById("contact").innerText = "";
			document.getElementById("profile_picture").src = "https://cdn.discordapp.com/attachments/922128925692420176/946504823220621384/missing-profile.png"
		}
	</script>
</body>
</html>