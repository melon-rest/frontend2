<!doctype html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="tw.css" rel="stylesheet">
  <script src="index.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/izitoast/1.4.0/js/iziToast.min.js" integrity="sha512-Zq9o+E00xhhR/7vJ49mxFNJ0KQw1E1TMWkPTxrWcnpfEFDEXgUiwJHIKit93EW/XxE31HSI5GEOW06G6BF1AtA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/izitoast/1.4.0/css/iziToast.min.css" integrity="sha512-O03ntXoVqaGUTAeAmvQ2YSzkCvclZEcPQu1eqloPaHfJ5RuNGiS4l+3duaidD801P50J28EHyonCV06CUlTSag==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
	<div class="flex h-screen bg-gray-900">
		<div class="m-auto max-w-lg p-8 bg-gray-800 text-white shadow-2xl">
			<form id="form">
				<p class="text-sm" id="taken"></p>
				<input placeholder="username" id="username" type="text" autocomplete="username" class="indigo-styled-input text-white">
				<input placeholder="password" id="password" type="password" autocomplete="current-password" class="indigo-styled-input text-white">
			</form>

			<button id="submit" class="indigo-styled-input w-20 mt-3">register :)</button>
		</div>
	</div>
	<script>
		const username = document.getElementById("username");
		const password = document.getElementById("password");
		const taken = document.getElementById("taken");
		let timer;
		
		document.getElementById("submit").addEventListener("click", async () => {
			const req = await fetch(`${window.bio_pages.api}/register`, {
				method: "POST",
				body: JSON.stringify({
					username: username.value,
					password: password.value
				}),

				headers: {
					"Content-Type": "application/json"
				}
			});

			const res = await req.json();

			if (req.ok) {
				iziToast.success({
					title: "Success",
					message: "You've registered a account! Please log in now!",
					position: "center",
					theme: "dark"
				});

				setTimeout(() => {
					window.location.href = "/";
				}, 1000);
			} else {
				iziToast.error({
					title: "Error",
					message: res.message,
					position: "center",
					theme: "dark"
				});
			}
		})
		username.addEventListener("input", () => {
			clearTimeout(timer);
			timer = setTimeout(async () => {
				const req = await fetch(`${window.bio_pages.api}/username-availability`, {
					method: "POST",
					body: JSON.stringify({
						username: username.value
					}),

					headers: {
						"Content-Type": "application/json"
					}
				});

				const res = await req.json();
				
				if(res.taken) {
					
					taken.innerText = "Username already in use :("
					taken.classList.remove("text-green-500");
					taken.classList.add("text-red-500");
				} else {
					taken.innerText = "Available for registration!"
					taken.classList.add("text-green-500");
					taken.classList.remove("text-red-500");
				}
				
			}, 500);
		})
	</script>
</body>
</html>